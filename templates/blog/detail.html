{% extends "base.html" %}

{% block title %}{{ post.title }}{% endblock %}

{% block content %}
<h1>{{ post.title }}</h1>

{% if post.image %}
    <img src="{{ post.image.url }}" alt="{{ post.title }}" style="max-width: 500px;">
{% endif %}

<p><strong>Автор:</strong> {{ post.author.username }}</p>
<p><strong>Дата публикации:</strong> {{ post.pub_date|date:"d.m.Y H:i" }}</p>
<p><strong>Категория:</strong> <a href="{% url 'blog:category' post.category.slug %}">{{ post.category.title }}</a></p>
{% if post.location %}
    <p><strong>Место:</strong> {{ post.location.name }}</p>
{% endif %}

<div style="margin: 20px 0; padding: 15px; background: #f9f9f9;">
    {{ post.text|linebreaks }}
</div>

{% if user == post.author %}
    <div style="margin: 20px 0;">
        <a href="{% url 'blog:edit' post.id %}" style="margin-right: 10px;">Редактировать</a>
        <a href="{% url 'blog:delete' post.id %}" style="color: red;">Удалить</a>
    </div>
{% endif %}

<hr>

<h3>Комментарии ({{ comments.count }})</h3>

{% if user.is_authenticated %}
    <form method="post" action="{% url 'blog:add_comment' post.id %}">
        {% csrf_token %}
        <textarea name="text" rows="3" cols="50" placeholder="Ваш комментарий"></textarea><br>
        <button type="submit">Добавить комментарий</button>
    </form>
{% else %}
    <p><a href="{% url 'users:login' %}">Войдите</a>, чтобы оставить комментарий.</p>
{% endif %}

{% for comment in comments %}
    <div style="border: 1px solid #ddd; padding: 10px; margin: 10px 0;">
        <p><strong>{{ comment.author.username }}</strong> ({{ comment.created_at|date:"d.m.Y H:i" }})</p>
        <p>{{ comment.text }}</p>
        
        {% if user == comment.author %}
            <div>
                <a href="{% url 'blog:edit_comment' post.id comment.id %}">Редактировать</a> |
                <a href="{% url 'blog:delete_comment' post.id comment.id %}" style="color: red;">Удалить</a>
            </div>
        {% endif %}
    </div>
{% empty %}
    <p>Пока нет комментариев. Будьте первым!</p>
{% endfor %}
{% endblock %}
